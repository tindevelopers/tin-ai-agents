
# StabilityAI Integration for AI BlogWriter Pro

This document explains the StabilityAI integration for generating realistic, natural-looking images for blog posts.

## ðŸš€ Features

- **Advanced Prompt Engineering**: Uses sophisticated prompts to generate natural, documentary-style photography
- **Aspect Ratio Support**: Supports 16:9, 4:3, and 1:1 aspect ratios for different image types
- **Realistic Image Generation**: Emphasizes photographic realism over typical AI-generated aesthetics
- **Robust Fallback System**: Graceful handling when API key is not configured
- **File Management**: Automatic saving of generated images to public directory

## ðŸ”§ Setup Instructions

### 1. Configure StabilityAI API Key

1. Go to [Stability AI Platform](https://platform.stability.ai/)
2. Sign up/login and navigate to your API keys section
3. Create a new API key
4. Add it to your `.env` file:

```bash
STABILITY_AI_API_KEY="sk-your-actual-stability-ai-api-key-here"
```

### 2. Directory Structure

The integration automatically creates the following directory:
```
public/
â””â”€â”€ generated-images/     # Where generated images are saved
```

## ðŸ“¡ API Endpoints

### `/api/asset-retrieval` (POST)
Main image generation endpoint that interfaces with StabilityAI.

**Request:**
```json
{
  "task": "Generate a realistic, natural-looking image using this detailed prompt: [YOUR_PROMPT]",
  "context": "Blog post generation context"
}
```

**Response (Success):**
```json
{
  "success": true,
  "url": "/generated-images/your-image.png",
  "filename": "your-image.png",
  "aspectRatio": "16:9",
  "size": {"width": 1344, "height": 768},
  "provider": "StabilityAI",
  "model": "stable-diffusion-xl-1024-v1-0",
  "generated": true
}
```

**Response (Placeholder Mode):**
```json
{
  "success": true,
  "url": "/generated-images/placeholder-your-image.jpg",
  "generated": false,
  "provider": "Placeholder",
  "note": "Placeholder image - configure STABILITY_AI_API_KEY for real image generation"
}
```

### `/api/test-stability` (POST)
Test endpoint for verifying StabilityAI integration.

**Request:**
```json
{
  "prompt": "A professional photo of a modern workspace"
}
```

## ðŸŽ¨ Image Generation Workflow

### 1. Advanced Prompt Analysis
The system uses a sophisticated AI prompt to analyze blog content and generate 3 image suggestions:

- **1 Featured Image** (16:9): For blog headers and social sharing
- **2 Body Images** (4:3 or 1:1): For supporting content within the article

### 2. Realistic Prompt Engineering
All generated prompts include these realism modifiers:

- "Natural lighting, shot with DSLR camera"
- "Documentary photography style"
- "Authentic candid moment" 
- "Slightly imperfect realistic details"
- "Unposed natural expressions"
- "Photojournalistic style"

### 3. StabilityAI Generation
- Uses `stable-diffusion-xl-1024-v1-0` model
- Configured with `photographic` style preset
- Optimized settings: 30 steps, CFG scale 7
- Supports multiple aspect ratios

### 4. File Management
- Images saved as PNG format in `/public/generated-images/`
- Automatic filename sanitization
- Timestamp-based unique naming

## ðŸ”§ Configuration Options

### StabilityAI Request Parameters
```typescript
{
  text_prompts: [{ text: imagePrompt, weight: 1 }],
  cfg_scale: 7,           // Guidance scale
  height: 768,            // Image height
  width: 1344,            // Image width  
  samples: 1,             // Number of images
  steps: 30,              // Generation steps
  style_preset: 'photographic'  // Style preset
}
```

### Supported Aspect Ratios
- **16:9**: 1344x768 (Featured images, headers)
- **4:3**: 1152x896 (Body images, standard)
- **1:1**: 1024x1024 (Body images, square)

## ðŸš¨ Error Handling

### API Key Issues
- Invalid/missing API key: Returns placeholder mode
- Rate limiting: Automatic fallback to mock responses
- Network errors: Graceful degradation

### Common Error Messages
- `"StabilityAI API key not configured"` - Set up your API key
- `"StabilityAI API error: 401"` - Invalid API key
- `"No images generated by StabilityAI"` - Generation failed

## ðŸ§ª Testing

### Test Image Generation
```bash
curl -X POST "http://localhost:3000/api/test-stability" \
  -H "Content-Type: application/json" \
  -d '{"prompt": "A professional workspace with natural lighting"}'
```

### Test Full Workflow
```bash
curl -X POST "http://localhost:3000/api/blog/generate-images" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Modern Web Development",
    "content": "Content about web development...",
    "keywords": ["web", "development", "programming"]
  }'
```

## ðŸ“Š Performance Notes

- **Generation Time**: 15-30 seconds per image
- **File Sizes**: ~2-5MB per PNG image
- **Rate Limits**: Check StabilityAI documentation
- **Costs**: ~$0.04 per image generation

## ðŸ”® Future Enhancements

- [ ] Add image style presets (artistic, cinematic, etc.)
- [ ] Implement batch generation optimization  
- [ ] Add image editing/modification features
- [ ] Support for additional aspect ratios
- [ ] Integration with cloud storage (S3/CloudFront)
- [ ] Image compression and optimization

---

**Note**: This integration provides both real StabilityAI generation and placeholder functionality, ensuring the system works even without API key configuration during development and testing.
